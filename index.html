<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…ã®ã—ãŠã‚Šã‚¢ãƒ—ãƒª</title>

    <!-- Tailwind CSSã®èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome (ã‚¢ã‚¤ã‚³ãƒ³) ã®èª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fontsã®èª­ã¿è¾¼ã¿ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã®å®šç¾© */
        body {
            font-family: 'Inter', 'M PLUS Rounded 1c', sans-serif;
            overscroll-behavior: none; /* ã‚¹ãƒ¯ã‚¤ãƒ—æ™‚ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œæˆ»ã‚‹ã€æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– */
            overflow: hidden;
        }

        /* é€²è¡Œä¸­ã®äºˆå®šã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .glowing-pulse {
            animation: glowing-pulse 2s infinite;
            box-shadow: 0 0 5px rgba(250, 204, 21, 0.8), 0 0 10px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4);
        }
        @keyframes glowing-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.95; }
        }

        /* èƒŒæ™¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚·ãƒãƒ¼åŠ¹æœï¼‰ */
        .shimmer-bg {
            background: linear-gradient(-45deg, #0f172a, #1e3a8a, #312e81, #0f172a); /* èƒŒæ™¯è‰²ã‚’æš—ã„å¯’è‰²ç³»ã«å¤‰æ›´ */
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ç”»é¢é·ç§»ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.4s ease-in-out;
            overflow-y: auto;
            padding-bottom: 80px; /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®é«˜ã•åˆ† */
        }
        .page-leave { transform: translateX(-100%); }
        .page-enter { transform: translateX(100%); }
        .page-active { transform: translateX(0); }
        .page-leave-reverse { transform: translateX(100%); }
        .page-enter-reverse { transform: translateX(-100%); }

        /* å¤©æ°—äºˆå ±ãƒšãƒ¼ã‚¸ã¨ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸å°‚ç”¨ã®ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¨­å®š */
        #weather-page, #map-page {
            padding-bottom: 0;
            overflow: hidden;
        }
        #weather-page .page-content, #map-page .page-content {
            height: calc(100vh - 80px); /* ç”»é¢å…¨ä½“ - ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®é«˜ã• */
            display: flex;
            flex-direction: column;
        }

        #windy-container, #gmap-container {
            flex-grow: 1; /* ã‚³ãƒ³ãƒ†ãƒŠã‚’ã„ã£ã±ã„ã«åºƒã’ã‚‹ */
            position: relative;
        }

        #windy-iframe, #gmap-iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
        
        .full-screen-iframe {
            width: 100vw;
            height: calc(100vh - 80px); /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚’é™¤ãå…¨ç”»é¢ */
        }
    </style>
</head>
<body class="shimmer-bg text-white antialiased overflow-hidden">

    <div id="app-container" class="relative w-full h-screen max-w-lg mx-auto bg-black bg-opacity-10 backdrop-blur-md overflow-hidden shadow-2xl">

        <!-- ===== ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ ===== -->
        <div id="main-page" class="page page-active">
            <div class="p-4 space-y-4">
                <header class="text-center">
                    <h1 class="text-2xl font-bold">ä»Šæ—¥ã®æ—…ç¨‹</h1>
                    <p id="current-time" class="text-sm opacity-80"></p>
                </header>
                <div id="current-status-card" class="bg-white/20 p-4 rounded-xl shadow-lg space-y-3 hidden">
                    <h2 class="font-bold text-lg flex items-center"><i class="fas fa-location-arrow mr-2"></i>ç¾åœ¨ã®çŠ¶æ³</h2>
                    <div class="space-y-2">
                        <p class="text-sm">
                            <span id="current-location">ç¾åœ¨åœ°</span> â†’ <span id="next-station" class="font-bold">æ¬¡ã®é§…</span>
                        </p>
                        <div class="w-full bg-gray-200/50 rounded-full h-2.5">
                            <div id="progress-bar" class="bg-yellow-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs opacity-90">
                            <span id="departure-time-info">å‡ºç™ºæ™‚åˆ»</span>
                            <span id="arrival-time-info">åˆ°ç€äºˆå®š: HH:MM</span>
                        </div>
                    </div>
                    <p id="line-info" class="text-sm bg-black/20 px-3 py-1 rounded-full text-center"><i class="fas fa-train mr-1"></i> è·¯ç·šãƒ»ãƒ›ãƒ¼ãƒ æƒ…å ±</p>
                </div>
                <div id="next-event-card" class="bg-white/20 p-4 rounded-xl shadow-lg space-y-2">
                    <h2 class="font-bold text-lg flex items-center"><i class="fas fa-flag-checkered mr-2"></i>æ¬¡ã®äºˆå®š</h2>
                    <p id="next-event-title" class="text-xl">æ¬¡ã®äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“</p>
                    <p id="next-event-time" class="text-sm opacity-80"></p>
                </div>
                <div class="space-y-3">
                    <h2 class="font-bold text-lg"><i class="fas fa-list-ul mr-2"></i>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2>
                    <div id="timeline-container" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- ===== ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ãƒšãƒ¼ã‚¸ ===== -->
        <div id="schedule-page" class="page page-enter">
            <div class="p-4 space-y-4">
                <h1 class="text-2xl font-bold text-center">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h1>
                <div class="bg-white/20 p-4 rounded-xl shadow-lg space-y-3">
                    <h2 class="font-bold text-lg">æ–°ã—ã„äºˆå®šã‚’è¿½åŠ </h2>
                    <input type="text" id="event-title" placeholder="äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ« (ä¾‹: åšç‰©é¤¨è¦‹å­¦)" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 placeholder-white/50 focus:ring-2 focus:ring-yellow-400">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="time" id="event-start" class="w-full bg-black/20 border-0 rounded-md px-3 py-2">
                        <input type="time" id="event-end" class="w-full bg-black/20 border-0 rounded-md px-3 py-2">
                    </div>
                    <select id="event-type" class="w-full bg-black/20 border-0 rounded-md px-3 py-2">
                        <option value="fas fa-walking">ğŸš¶ å¾’æ­©</option>
                        <option value="fas fa-train">ğŸš† é›»è»Š</option>
                        <option value="fas fa-bus">ğŸšŒ ãƒã‚¹</option>
                        <option value="fas fa-utensils">ğŸ½ï¸ é£Ÿäº‹</option>
                        <option value="fas fa-shopping-cart">ğŸ›ï¸ è²·ã„ç‰©</option>
                        <option value="fas fa-camera">ğŸ“· è¦³å…‰</option>
                        <option value="fas fa-bed">ğŸ¨ å®¿æ³Š</option>
                        <option value="fas fa-info-circle">ğŸ“ ãã®ä»–</option>
                    </select>
                    <textarea id="event-details" placeholder="è©³ç´° (ä¾‹: è·¯ç·šæƒ…å ±ã€å ´æ‰€ãªã©)" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 h-20 placeholder-white/50 focus:ring-2 focus:ring-yellow-400"></textarea>
                    <button id="add-event-btn" class="w-full bg-yellow-400 text-black font-bold py-2 rounded-md hover:bg-yellow-500 transition-colors">è¿½åŠ ã™ã‚‹</button>
                </div>
                <div class="space-y-3">
                    <h2 class="font-bold text-lg">äºˆå®šä¸€è¦§</h2>
                    <div id="schedule-list-container" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- ===== ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸ ===== -->
        <div id="map-page" class="page page-enter">
            <div class="page-content">
                <div class="p-4 space-y-4">
                    <h1 class="text-2xl font-bold text-center"><i class="fas fa-map-marked-alt mr-2"></i>ãƒ«ãƒ¼ãƒˆç¢ºèª</h1>
                </div>
                <div id="gmap-container" class="rounded-lg overflow-hidden shadow-lg">
                     <iframe id="gmap-iframe" class="w-full h-full border-0" allowfullscreen="" loading="lazy"></iframe>
                     <div id="map-placeholder" class="absolute inset-0 bg-white/20 flex items-center justify-center text-center p-4">
                        <p>Googleãƒã‚¤ãƒãƒƒãƒ—ã®åŸ‹ã‚è¾¼ã¿URLã‚’<br>è¨­å®šãƒšãƒ¼ã‚¸ã‹ã‚‰å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                     </div>
                </div>
            </div>
        </div>

        <!-- ===== å¤©æ°—äºˆå ±ãƒšãƒ¼ã‚¸ ===== -->
        <div id="weather-page" class="page page-enter">
            <div class="page-content">
                <div class="p-4 space-y-4">
                    <h1 class="text-2xl font-bold text-center"><i class="fas fa-cloud-sun mr-2"></i>å¤©æ°—äºˆå ±</h1>
                </div>
                <div id="windy-container" class="rounded-lg overflow-hidden shadow-lg">
                    <iframe id="windy-iframe" frameborder="0" loading="lazy"></iframe>
                    <div id="weather-placeholder" class="absolute inset-0 bg-white/20 flex items-center justify-center text-center p-4">
                        <p id="weather-placeholder-text">å¤©æ°—äºˆå ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
                <div class="text-center space-x-2 mt-4 p-4">
                    <button id="get-current-weather-btn" class="bg-yellow-400 text-black font-bold py-2 px-4 rounded-md hover:bg-yellow-500 transition-colors">ç¾åœ¨åœ°ã®å¤©æ°—</button>
                    <button id="get-settings-weather-btn" class="bg-sky-500 text-white font-bold py-2 px-4 rounded-md hover:bg-sky-600 transition-colors">è¨­å®šåœ°ç‚¹ã®å¤©æ°—</button>
                </div>
            </div>
        </div>

        <!-- ===== ãƒ«ãƒ¼ãƒˆæ¤œç´¢ãƒšãƒ¼ã‚¸ ===== -->
        <div id="route-page" class="page page-enter">
             <div class="p-4 space-y-4">
                <h1 class="text-2xl font-bold text-center">äº¤é€šãƒ«ãƒ¼ãƒˆæ¤œç´¢</h1>
                <div class="bg-white/20 p-4 rounded-xl shadow-lg space-y-3">
                    <input type="text" id="origin" placeholder="å‡ºç™ºåœ° (ä¾‹: æ±äº¬é§…)" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 placeholder-white/50 focus:ring-2 focus:ring-yellow-400">
                    <input type="text" id="destination" placeholder="ç›®çš„åœ° (ä¾‹: æ–°å®¿å¾¡è‹‘)" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 placeholder-white/50 focus:ring-2 focus:ring-yellow-400">
                    <button id="search-route-btn" class="w-full bg-yellow-400 text-black font-bold py-2 rounded-md hover:bg-yellow-500 transition-colors">ãƒ«ãƒ¼ãƒˆã‚’æ¤œç´¢</button>
                </div>
                <div id="route-results-container" class="space-y-2"></div>
                <div id="loading-indicator" class="hidden text-center py-4">
                    <i class="fas fa-spinner fa-spin text-2xl"></i>
                    <p>æ¤œç´¢ä¸­...</p>
                </div>
             </div>
        </div>

        <!-- ===== è¨­å®šãƒšãƒ¼ã‚¸ ===== -->
        <div id="settings-page" class="page page-enter">
            <div class="p-4 space-y-4">
                <h1 class="text-2xl font-bold text-center">è¨­å®š</h1>
                <div class="bg-white/20 p-4 rounded-xl shadow-lg space-y-3">
                    <h2 class="font-bold text-lg">Google Maps APIã‚­ãƒ¼</h2>
                    <p class="text-xs opacity-80">ãƒ«ãƒ¼ãƒˆæ¤œç´¢æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€ã”è‡ªèº«ã®APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>
                    <input type="password" id="api-key-input" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 placeholder-white/50 focus:ring-2 focus:ring-yellow-400">
                    <h2 class="font-bold text-lg mt-4">Googleãƒã‚¤ãƒãƒƒãƒ—URL</h2>
                    <p class="text-xs opacity-80">Googleãƒã‚¤ãƒãƒƒãƒ—ã§ã€Œã‚µã‚¤ãƒˆã«åŸ‹ã‚è¾¼ã‚€ã€ã‚’é¸æŠã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹HTMLã‹ã‚‰ã€src="... " ã®URLéƒ¨åˆ†ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
                    <input type="url" id="gmap-url-input" placeholder="ãƒã‚¤ãƒãƒƒãƒ—ã®åŸ‹ã‚è¾¼ã¿URL" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 placeholder-white/50 focus:ring-2 focus:ring-yellow-400">
                    <h2 class="font-bold text-lg mt-4">å¤©æ°—äºˆå ±åœ°ç‚¹</h2>
                    <p class="text-xs opacity-80">å¤©æ°—äºˆå ±ã‚’è¡¨ç¤ºã—ãŸã„åœ°ç‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆä¾‹: æ±äº¬éƒ½, æ—¥æœ¬ï¼‰</p>
                    <input type="text" id="weather-location-input" placeholder="åœ°ç‚¹ã‚’å…¥åŠ› (ä¾‹: æ±äº¬éƒ½)" class="w-full bg-black/20 border-0 rounded-md px-3 py-2 placeholder-white/50 focus:ring-2 focus:ring-yellow-400">
                    <button id="save-settings-btn" class="w-full bg-yellow-400 text-black font-bold py-2 rounded-md hover:bg-yellow-500 transition-colors mt-4">è¨­å®šã‚’ä¿å­˜</button>
                </div>
                <div class="bg-white/20 p-4 rounded-xl shadow-lg space-y-3">
                    <h2 class="font-bold text-lg">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                    <button id="clear-data-btn" class="w-full bg-red-500 text-white font-bold py-2 rounded-md hover:bg-red-600 transition-colors">å…¨ã¦ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‰Šé™¤</button>
                </div>
            </div>
        </div>
        
        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚° (confirm/alertã®ä»£æ›¿) -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white/90 backdrop-blur-md p-6 rounded-xl shadow-lg w-full max-w-sm text-black text-center space-y-4 relative">
                <p id="modal-message" class="text-lg"></p>
                <div id="modal-buttons" class="flex justify-center space-x-4">
                    <button id="modal-ok-btn" class="bg-yellow-400 px-4 py-2 rounded-md font-bold hover:bg-yellow-500 transition-colors">OK</button>
                    <button id="modal-cancel-btn" class="bg-gray-300 px-4 py-2 rounded-md font-bold hover:bg-gray-400 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
        </div>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="absolute bottom-0 left-0 right-0 bg-black/30 backdrop-blur-sm p-2 flex justify-around">
            <button data-page="main-page" class="nav-btn text-yellow-400 flex flex-col items-center w-1/5">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs">ãƒ›ãƒ¼ãƒ </span>
            </button>
            <button data-page="schedule-page" class="nav-btn text-white/80 flex flex-col items-center w-1/5">
                <i class="fas fa-calendar-alt text-xl"></i>
                <span class="text-xs">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
            </button>
            <button data-page="map-page" class="nav-btn text-white/80 flex flex-col items-center w-1/5">
                <i class="fas fa-map text-xl"></i>
                <span class="text-xs">ãƒãƒƒãƒ—</span>
            </button>
            <button data-page="weather-page" class="nav-btn text-white/80 flex flex-col items-center w-1/5">
                <i class="fas fa-cloud-sun text-xl"></i>
                <span class="text-xs">å¤©æ°—</span>
            </button>
            <button data-page="route-page" class="nav-btn text-white/80 flex flex-col items-center w-1/5">
                <i class="fas fa-route text-xl"></i>
                <span class="text-xs">ãƒ«ãƒ¼ãƒˆ</span>
            </button>
            <button data-page="settings-page" class="nav-btn text-white/80 flex flex-col items-center w-1/5">
                <i class="fas fa-cog text-xl"></i>
                <span class="text-xs">è¨­å®š</span>
            </button>
        </nav>
    </div>

    <script>
        let schedule = [];
        let googleApiKey = '';
        let googleMapUrl = '';
        let weatherLocation = '';
        let directionsService;
        let geocoder;
        let currentPage = 'main-page';
        let isNavigating = false;
        let googleMapsLoaded = false;
        let modalResolve;
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }

        function showModal(message, isConfirm = false) {
            const modal = document.getElementById('modal');
            const modalMessage = document.getElementById('modal-message');
            const modalButtons = document.getElementById('modal-buttons');
            const okBtn = document.getElementById('modal-ok-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            modalMessage.textContent = message;
            
            // ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã®å ´åˆã¯ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            if (isConfirm) {
                modalButtons.classList.remove('hidden');
                okBtn.style.display = 'inline-block';
                okBtn.textContent = 'OK';
                cancelBtn.style.display = 'inline-block';
            } else {
                modalButtons.classList.remove('hidden'); // ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã¯å¸¸ã«è¡¨ç¤º
                okBtn.style.display = 'block';
                okBtn.textContent = 'é–‰ã˜ã‚‹';
                cancelBtn.style.display = 'none';
            }

            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            
            return new Promise(resolve => {
                modalResolve = resolve;
                if (isConfirm) {
                    okBtn.onclick = () => {
                        closeModal();
                        resolve(true);
                    };
                    cancelBtn.onclick = () => {
                        closeModal();
                        resolve(false);
                    };
                } else {
                     okBtn.onclick = () => {
                        closeModal();
                    };
                }
            });
        }
        
        function initGoogleMaps() {
            if (googleApiKey && !googleMapsLoaded) {
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${googleApiKey}&libraries=places&callback=onGoogleMapsLoaded`;
                document.head.appendChild(script);
                googleMapsLoaded = true;
            }
        }

        window.onGoogleMapsLoaded = function() {
            if (typeof google !== 'undefined') {
                directionsService = new google.maps.DirectionsService();
                geocoder = new google.maps.Geocoder();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            initGoogleMaps();
            renderAll();
            setupEventListeners();
            setInterval(updateRealtimeStatus, 1000);
            
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«Windyã¨ãƒãƒƒãƒ—ã‚’ãƒ­ãƒ¼ãƒ‰
            loadWindy();
            renderMap();
        });

        function loadData() {
            const savedSchedule = localStorage.getItem('travelSchedule');
            if (savedSchedule) {
                schedule = JSON.parse(savedSchedule);
            } else {
                schedule = [
                    { id: 1, title: 'ç¾½ç”°ç©ºæ¸¯ã«åˆ°ç€', start: '09:00', end: '09:30', type: 'fas fa-plane-arrival', details: 'ç¬¬1ã‚¿ãƒ¼ãƒŸãƒŠãƒ«' },
                    { id: 2, title: 'ãƒªãƒ ã‚¸ãƒ³ãƒã‚¹ã§ç§»å‹•', start: '09:45', end: '10:30', type: 'fas fa-bus', details: 'æ–°å®¿é§…è¥¿å£è¡Œã' },
                    { id: 3, title: 'ãƒ›ãƒ†ãƒ«ã«ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³', start: '11:00', end: '11:30', type: 'fas fa-bed', details: 'è·ç‰©ã‚’é ã‘ã‚‹' },
                ];
            }
            googleApiKey = localStorage.getItem('googleApiKey') || '';
            googleMapUrl = localStorage.getItem('googleMapUrl') || "https://www.google.com/maps/d/u/0/embed?mid=1W_k8BLKMwj87q0JcgqtTvvG2qFRJBpk&ehbc=2E312F&noprof=1";
            weatherLocation = localStorage.getItem('weatherLocation') || '';
            document.getElementById('api-key-input').value = googleApiKey;
            document.getElementById('gmap-url-input').value = googleMapUrl;
            document.getElementById('weather-location-input').value = weatherLocation;
        }

        function saveData() {
            localStorage.setItem('travelSchedule', JSON.stringify(schedule));
            localStorage.setItem('googleApiKey', googleApiKey);
            localStorage.setItem('googleMapUrl', googleMapUrl);
            localStorage.setItem('weatherLocation', weatherLocation);
        }
        
        function sortSchedule() {
            schedule.sort((a, b) => a.start.localeCompare(b.start));
        }

        function renderAll() {
            sortSchedule();
            renderTimeline();
            renderScheduleList();
            updateRealtimeStatus();
            renderMap();
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';
            if (schedule.length === 0) {
                container.innerHTML = '<p class="text-center opacity-70">äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            const now = new Date();
            const currentTimeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            schedule.forEach(event => {
                const isCurrent = currentTimeStr >= event.start && currentTimeStr < event.end;
                const isPast = currentTimeStr >= event.end;
                let cardClass = isCurrent ? 'bg-yellow-400/80 text-black glowing-pulse' : isPast ? 'bg-black/20 opacity-60' : 'bg-white/20';
                const item = document.createElement('div');
                item.className = `flex items-start space-x-3 p-3 rounded-xl transition-all ${cardClass}`;
                item.innerHTML = `<div class="flex flex-col items-center"><i class="${event.type} text-xl w-6 text-center"></i><div class="w-px h-full bg-white/50 flex-grow mt-1"></div></div><div><p class="font-bold">${event.start} - ${event.end}</p><h3 class="text-lg">${event.title}</h3>${event.details ? `<p class="text-sm opacity-80">${event.details}</p>` : ''}</div>`;
                container.appendChild(item);
            });
        }
        
        function renderScheduleList() {
            const container = document.getElementById('schedule-list-container');
            container.innerHTML = '';
            if (schedule.length === 0) {
                container.innerHTML = '<p class="text-center opacity-70">äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            schedule.forEach(event => {
                const item = document.createElement('div');
                item.className = 'bg-black/20 p-3 rounded-lg flex justify-between items-center';
                item.innerHTML = `<div><p class="font-bold">${event.start} - ${event.end} <i class="${event.type} ml-2"></i></p><p>${event.title}</p></div><button class="delete-event-btn text-red-400 hover:text-red-500" data-id="${event.id}"><i class="fas fa-trash-alt fa-lg"></i></button>`;
                container.appendChild(item);
            });
            document.querySelectorAll('.delete-event-btn').forEach(button => button.addEventListener('click', deleteEvent));
        }

        function renderMap() {
            const iframe = document.getElementById('gmap-iframe');
            const placeholder = document.getElementById('map-placeholder');
            if (googleMapUrl) {
                iframe.src = googleMapUrl;
                iframe.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                iframe.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }
        }

        function loadWindy() {
            const iframe = document.getElementById('windy-iframe');
            const placeholder = document.getElementById('weather-placeholder');
            const placeholderText = document.getElementById('weather-placeholder-text');

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šã®åŸ‹ã‚è¾¼ã¿URLã‚’ã‚»ãƒƒãƒˆ
            const defaultSrc = `https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=mm&metricTemp=%C2%B0C&metricWind=m/s&zoom=8&overlay=radar&product=radar&level=surface&lat=35.142&lon=138.928&detailLat=35.489&detailLon=139.482&detail=true&pressure=true`;
            iframe.src = defaultSrc;

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æ¶ˆã™
            iframe.onload = () => {
                placeholder.classList.add('hidden');
            };
        }
        
        function updateRealtimeStatus() {
            document.getElementById('current-time').textContent = new Date().toLocaleString('ja-JP');
            const now = new Date();
            const currentTimeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            let currentEvent = null;
            let nextEvent = schedule.find(event => currentTimeStr < event.start);
            for (const event of schedule) {
                if (currentTimeStr >= event.start && currentTimeStr < event.end) currentEvent = event;
            }

            const currentStatusCard = document.getElementById('current-status-card');
            if (currentEvent && /train|bus|plane|route/.test(currentEvent.type)) {
                currentStatusCard.classList.remove('hidden');
                const start = new Date(`${now.toDateString()} ${currentEvent.start}`);
                const end = new Date(`${now.toDateString()} ${currentEvent.end}`);
                if (end < start) end.setDate(end.getDate() + 1);
                const progress = Math.min(100, Math.max(0, (now - start) / (end - start) * 100));
                document.getElementById('progress-bar').style.width = `${progress}%`;
                const [origin, destination] = currentEvent.title.split('â†’');
                document.getElementById('current-location').textContent = origin ? origin.trim() : 'å‡ºç™ºåœ°';
                document.getElementById('next-station').textContent = destination ? destination.trim() : 'ç›®çš„åœ°';
                document.getElementById('departure-time-info').textContent = currentEvent.start;
                document.getElementById('arrival-time-info').textContent = `åˆ°ç€äºˆå®š: ${currentEvent.end}`;
                document.getElementById('line-info').innerHTML = `<i class="${currentEvent.type} mr-1"></i> ${currentEvent.details || 'è©³ç´°æƒ…å ±ãªã—'}`;
            } else {
                currentStatusCard.classList.add('hidden');
            }
            
            const nextEventTitle = document.getElementById('next-event-title');
            const nextEventTime = document.getElementById('next-event-time');
            if (nextEvent) {
                nextEventTitle.textContent = nextEvent.title;
                nextEventTime.textContent = `${nextEvent.start} - ${nextEvent.end}`;
            } else if (currentEvent) {
                nextEventTitle.textContent = "ç¾åœ¨é€²è¡Œä¸­ï¼š" + currentEvent.title;
                nextEventTime.textContent = `${currentEvent.start} - ${currentEvent.end}`;
            } else {
                nextEventTitle.textContent = 'æ¬¡ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“';
                nextEventTime.textContent = '';
            }
            renderTimeline();
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', () => navigateTo(btn.dataset.page)));
            document.getElementById('add-event-btn').addEventListener('click', addEvent);
            document.getElementById('search-route-btn').addEventListener('click', searchRoute);
            document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
            document.getElementById('clear-data-btn').addEventListener('click', async () => {
                const confirmed = await showModal('æœ¬å½“ã«ã™ã¹ã¦ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ', true);
                if (confirmed) {
                    schedule = []; saveData(); renderAll();
                }
            });
            
            document.getElementById('get-current-weather-btn').addEventListener('click', () => loadWeatherByLocation(null, true));
            document.getElementById('get-settings-weather-btn').addEventListener('click', () => loadWeatherByLocation(weatherLocation, false));


            let touchstartX = 0;
            const appContainer = document.getElementById('app-container');
            appContainer.addEventListener('touchstart', e => { touchstartX = e.changedTouches[0].screenX; }, { passive: true });
            appContainer.addEventListener('touchend', e => { handleSwipe(touchstartX, e.changedTouches[0].screenX); }, { passive: true });
        }
            
        function handleSwipe(touchstartX, touchendX) {
            const pages = ['main-page', 'schedule-page', 'map-page', 'weather-page', 'route-page', 'settings-page'];
            const currentIndex = pages.indexOf(currentPage);
            if (touchendX < touchstartX - 50) { // Left swipe
                const nextIndex = Math.min(pages.length - 1, currentIndex + 1);
                if (currentIndex !== nextIndex) navigateTo(pages[nextIndex]);
            }
            if (touchendX > touchstartX + 50) { // Right swipe
                const prevIndex = Math.max(0, currentIndex - 1);
                if (currentIndex !== prevIndex) navigateTo(pages[prevIndex]);
            }
        }
        
        /**
         * ãƒšãƒ¼ã‚¸é·ç§»ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
         * @param {string} pageId - é·ç§»å…ˆã®ãƒšãƒ¼ã‚¸ID
         */
        function navigateTo(pageId) {
            if (currentPage === pageId || isNavigating) return;
            isNavigating = true;

            const currentPageEl = document.getElementById(currentPage);
            const nextPageEl = document.getElementById(pageId);
            const navButtons = document.querySelectorAll('.nav-btn');

            if (!currentPageEl || !nextPageEl) {
                isNavigating = false;
                return;
            }

            const pageOrder = ['main-page', 'schedule-page', 'map-page', 'weather-page', 'route-page', 'settings-page'];
            const currentPageIndex = pageOrder.indexOf(currentPage);
            const nextPageIndex = pageOrder.indexOf(pageId);
            const isForward = nextPageIndex > currentPageIndex;

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
            const onTransitionEnd = () => {
                nextPageEl.removeEventListener('transitionend', onTransitionEnd);
                
                // å¤ã„ãƒšãƒ¼ã‚¸ã§æ„å›³ã—ãªã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·ããªã„ã‚ˆã†ã€ä¸€æ™‚çš„ã«transitionã‚’ç„¡åŠ¹åŒ–
                currentPageEl.style.transition = 'none';
                
                // å¤ã„ãƒšãƒ¼ã‚¸ã®çŠ¶æ…‹ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ
                currentPageEl.classList.remove('page-active', 'page-leave', 'page-leave-reverse');
                currentPageEl.classList.add('page-enter'); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç”»é¢å¤–ï¼ˆå³ï¼‰çŠ¶æ…‹ã«æˆ»ã™
                
                // ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ã‚’å³æ™‚åæ˜ ã•ã›ã‚‹ãŸã‚ã®ãƒãƒƒã‚¯
                currentPageEl.offsetHeight; 
                
                // transitionã‚’å…ƒã«æˆ»ã—ã¦ã€æ¬¡ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚™ãˆã‚‹
                currentPageEl.style.transition = '';
                // === ã“ã“ã¾ã§ãŒä¿®æ­£ç®‡æ‰€ ===

                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã‚’æ›´æ–°
                currentPage = pageId;
                isNavigating = false;
            };
            nextPageEl.addEventListener('transitionend', onTransitionEnd);

            // æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’é–‹å§‹ä½ç½®ã«ã‚»ãƒƒãƒˆ
            nextPageEl.classList.remove('page-enter', 'page-enter-reverse');
            nextPageEl.classList.add(isForward ? 'page-enter' : 'page-enter-reverse');
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
            requestAnimationFrame(() => {
                currentPageEl.classList.add(isForward ? 'page-leave' : 'page-leave-reverse');
                currentPageEl.classList.remove('page-active');
                nextPageEl.classList.remove('page-enter', 'page-enter-reverse');
                nextPageEl.classList.add('page-active');
            });

            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
            navButtons.forEach(btn => {
                btn.classList.toggle('text-yellow-400', btn.dataset.page === pageId);
                btn.classList.toggle('text-white/80', btn.dataset.page !== pageId);
            });
        }


        async function addEvent() {
            const title = document.getElementById('event-title').value;
            const start = document.getElementById('event-start').value;
            const end = document.getElementById('event-end').value;
            const type = document.getElementById('event-type').value;
            const details = document.getElementById('event-details').value;

            if (!title || !start || !end) {
                await showModal('ã‚¿ã‚¤ãƒˆãƒ«ã€é–‹å§‹æ™‚åˆ»ã€çµ‚äº†æ™‚åˆ»ã¯å¿…é ˆã§ã™ã€‚'); return;
            }
            schedule.push({ id: Date.now(), title, start, end, type, details });
            saveData();
            renderAll();
            document.getElementById('event-title').value = '';
            document.getElementById('event-start').value = '';
            document.getElementById('event-end').value = '';
            document.getElementById('event-details').value = '';
            navigateTo('main-page');
        }

        async function deleteEvent(e) {
            const confirmed = await showModal('ã“ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ', true);
            if (confirmed) {
                const eventId = parseInt(e.currentTarget.dataset.id);
                schedule = schedule.filter(event => event.id !== eventId);
                saveData(); renderAll();
            }
        }

        async function saveSettings() {
            googleApiKey = document.getElementById('api-key-input').value;
            googleMapUrl = document.getElementById('gmap-url-input').value;
            weatherLocation = document.getElementById('weather-location-input').value;
            initGoogleMaps();
            saveData(); 
            renderMap();
            await showModal('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚'); navigateTo('main-page');
        }

        async function searchRoute() {
            if (!googleApiKey || typeof google === 'undefined' || !directionsService) {
                await showModal('Google Maps APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã‹ã€èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šãƒšãƒ¼ã‚¸ã§ã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'); 
                navigateTo('settings-page'); 
                return;
            }
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            if (!origin || !destination) {
                await showModal('å‡ºç™ºåœ°ã¨ç›®çš„åœ°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return;
            }
            
            const resultsContainer = document.getElementById('route-results-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            resultsContainer.innerHTML = '';
            loadingIndicator.classList.remove('hidden');

            const payload = {
                origin: origin,
                destination: destination,
                travelMode: 'TRANSIT',
                provideRouteAlternatives: true
            };
            
            try {
                // DirectionsService APIã¯APIã‚­ãƒ¼ã‚’å¿…è¦ã¨ã™ã‚‹ãŸã‚ã€Google Maps APIã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
                directionsService.route(payload, async (result, status) => {
                    loadingIndicator.classList.add('hidden');
                    if (status == 'OK') {
                        result.routes.slice(0, 3).forEach((route, index) => {
                            const leg = route.legs[0];
                            const summary = leg.steps.filter(s => s.travel_mode === 'TRANSIT').map(s => s.transit.line.name).join(' â†’ ');
                            const card = document.createElement('div');
                            card.className = 'bg-white/20 p-3 rounded-lg cursor-pointer hover:bg-white/30';
                            card.innerHTML = `<div class="flex justify-between items-center"><p class="font-bold text-lg">å€™è£œ ${index + 1} <span class="text-sm font-normal">(${leg.duration.text})</span></p><p class="font-bold">${leg.departure_time.text} â†’ ${leg.arrival_time.text}</p></div><p class="text-sm opacity-90 truncate">${summary}</p>`;
                            card.addEventListener('click', async () => {
                                const confirmed = await showModal(`äºˆå®šã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ\n${origin} â†’ ${destination}`, true);
                                if (confirmed) {
                                    schedule.push({ id: Date.now(), title: `${origin} â†’ ${destination}`, start: leg.departure_time.text.replace(/am|pm/i, '').trim(), end: leg.arrival_time.text.replace(/am|pm/i, '').trim(), type: 'fas fa-route', details: summary });
                                    saveData(); renderAll(); navigateTo('schedule-page');
                                }
                            });
                            resultsContainer.appendChild(card);
                        });
                    } else {
                        resultsContainer.innerHTML = `<p class="text-center text-red-400">ãƒ«ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚(ã‚¨ãƒ©ãƒ¼: ${status})</p>`;
                    }
                });
            } catch (error) {
                loadingIndicator.classList.add('hidden');
                console.error("Directions API call failed:", error);
                await showModal('ãƒ«ãƒ¼ãƒˆæ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        async function loadWeatherByLocation(location, isCurrentLocation = false) {
            const iframe = document.getElementById('windy-iframe');
            const placeholder = document.getElementById('weather-placeholder');
            const placeholderText = document.getElementById('weather-placeholder-text');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ
            placeholderText.innerHTML = `<i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>å¤©æ°—äºˆå ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>`;
            placeholder.classList.remove('hidden');

            let lat = 0;
            let lon = 0;
            let detailLat = 0;
            let detailLon = 0;

            if (isCurrentLocation) {
                if (navigator.geolocation) {
                    try {
                        const position = await new Promise((resolve, reject) => {
                            navigator.geolocation.getCurrentPosition(resolve, reject);
                        });
                        lat = position.coords.latitude;
                        lon = position.coords.longitude;
                        detailLat = lat;
                        detailLon = lon;
                    } catch (error) {
                        console.error('Geolocation error:', error);
                        await showModal('ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ä½ç½®æƒ…å ±ã®åˆ©ç”¨ã‚’è¨±å¯ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        placeholderText.innerHTML = `ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>è¨­å®šåœ°ç‚¹ã®å¤©æ°—äºˆå ±ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚`;
                        return;
                    }
                } else {
                    console.log('Geolocation is not supported by this browser.');
                    await showModal('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ç¾åœ¨åœ°æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                    placeholderText.innerHTML = `ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯<br>ç¾åœ¨åœ°æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`;
                    return;
                }
            } else if (location) {
                if (!googleApiKey || typeof google === 'undefined' || !google.maps.Geocoder) {
                    await showModal('Google Maps APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã‹ã€èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šãƒšãƒ¼ã‚¸ã§ã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'); 
                    navigateTo('settings-page');
                    return;
                }
                
                try {
                    const { results } = await geocoder.geocode({ address: location });
                    if (results.length > 0) {
                        const { lat: gLat, lng: gLng } = results[0].geometry.location;
                        lat = gLat();
                        lon = gLng();
                        detailLat = lat;
                        detailLon = lon;
                    } else {
                        await showModal('æŒ‡å®šã•ã‚ŒãŸåœ°ç‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                        placeholderText.innerHTML = `æŒ‡å®šã•ã‚ŒãŸåœ°ç‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>åˆ¥ã®åœ°ç‚¹ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚`;
                        return;
                    }
                } catch (error) {
                    console.error('Geocoder API call failed:', error);
                    await showModal('åœ°ç‚¹ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    placeholderText.innerHTML = `åœ°ç‚¹ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚<br>è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`;
                    return;
                }
            } else {
                await showModal('å¤©æ°—äºˆå ±ã‚’è¡¨ç¤ºã™ã‚‹åœ°ç‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                placeholderText.innerHTML = `å¤©æ°—äºˆå ±ã‚’è¡¨ç¤ºã™ã‚‹åœ°ç‚¹ãŒ<br>è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`;
                return;
            }

            const src = `https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=mm&metricTemp=%C2%B0C&metricWind=m/s&zoom=8&overlay=radar&product=radar&level=surface&lat=${lat}&lon=${lon}&detailLat=${detailLat}&detailLon=${detailLon}&detail=true&pressure=true`;
            iframe.src = src;
            iframe.onload = () => {
                placeholder.classList.add('hidden');
            };
        }
    </script>
</body>
</html>
